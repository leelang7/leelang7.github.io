## 1. VcXsrv Windows X Server 설치하기

- Docker에서 사용하는 Linux는 화면을 출력하기 위해서는 [X11](https://ko.wikipedia.org/wiki/X_윈도_시스템)이라는 프로토콜을 이용합니다. [X11](https://ko.wikipedia.org/wiki/X_윈도_시스템)을 Windows에서 사용할 수 있도록 하기 위한 [VcXsrv](https://sourceforge.net/projects/vcxsrv/)라는 프로그램을 설치하는 과정입니다.
- [VcXsrv Windows X Server](https://sourceforge.net/projects/vcxsrv/) 사이트에 접속 후 설치 프로그램을 다운로드합니다.



![img](https://blog.kakaocdn.net/dn/cb9FX4/btsnruDL66l/AHwrCtXkqrSwZ20RGK0Yr0/img.png)



- 다운로드한 설치 프로그램을 더블클릭해서 ‘VcXsrv’ 프로그램을 설치합니다.



![img](https://blog.kakaocdn.net/dn/K98FO/btsnoJhAsu2/eGN49zPB9Zmwbz899hlfKK/img.png)



- Windows 프로그램에서 ‘XLaunch’를 실행합니다.



![img](https://blog.kakaocdn.net/dn/PS5cm/btsnnfB2Inv/vJbJwF5KMkxwhwTDLw68B1/img.png)



- ‘Display settings’ 창에서 ‘Display number’를 0으로 설정하고 ‘다음’ 버튼을 누릅니다.



![img](https://blog.kakaocdn.net/dn/bRRuLR/btsnqwhvFHD/BTkClYqXwyYqbP0MGvz6sK/img.png)



- ‘Client startup’ 창에서는 기본 값 그대로 ‘다음’ 버튼을 누릅니다.



![img](https://blog.kakaocdn.net/dn/5k9mI/btsnoEgszz5/PYMfjne1hSZaoeskG9Ddc1/img.png)



- ‘Extra settings’ 창에서 ‘Disable access control’을 선택 후 ‘다음’ 버튼을 누릅니다.



![img](https://blog.kakaocdn.net/dn/cwm5Nm/btsnqe2omQ1/wKCfaz8erztcJ2h0s9cuKk/img.png)



- ‘Finish configuration’ 창에서 ‘마침’ 버튼을 누르면 설정이 완료됩니다. ‘Save configuration’ 버튼을 눌러서 설정값을 저장해 놓으면 이후에는 저장된 설정값을 더블 클릭하면 현재 설정으로 ‘VcXsrv’가 실행됩니다.



![img](https://blog.kakaocdn.net/dn/MG7WO/btsnnNykseC/AYFLIcHzMnk0UQpFJbkLAK/img.png)



- Windows의 ‘작업 표시줄’의 ‘숨겨진 아이콘 표시’를 누르면 ‘XLaunch’ 아이콘을 확인할 수 있습니다.



![img](https://blog.kakaocdn.net/dn/BEi5H/btsnoDojL3j/Qcbn78BocjJhfp3rp5ouuK/img.png)





## 2. **Docker Desktop 설치**

https://www.docker.com/products/docker-desktop/

- 적당한 위치에 ‘ros.yml’ 파일을 만들고 내용을 아래와 같이 편집합니다.(ex. C:\Users\admin\LSC) 

```
name: ros
services:
  ros2:
    image: osrf/ros:humble-desktop-full
    container_name: ros-ros2
    environment:
        DISPLAY: host.docker.internal:0.0
    ports:
        - “10000:10000”
    stdin_open: true
    tty: true
    entrypoint: /bin/bash
```

- 아래 명령을 ‘Windows Power Shell’에서 실행해서 ROS2 docker 이미지를 설치합니다.

```
$ docker-compose -f .\ros.yml up
```

![img](https://blog.kakaocdn.net/dn/cDaPsu/btsnqTwWFRg/Bka8t5fn8oSl2ZeUmXsIs1/img.png)



- 아래와 같이 ROS2 docker 컨테이너가 실행 중인 것을 확인할 수 있습니다.

![img](https://blog.kakaocdn.net/dn/kEwtY/btsnpVu5A7E/9R06Klk1FOoWfFdaJdEqZk/img.png)



- 터미널에서 도커 구동 확인

C:\Users\admin\LSC>docker ps
CONTAINER ID   IMAGE                          COMMAND       CREATED         STATUS         PORTS                      NAMES
368d2b103abc   osrf/ros:humble-desktop-full   "/bin/bash"   2 minutes ago   Up 2 minutes   0.0.0.0:10000->10000/tcp   ros-ros2

- 환경변수 초기화(출력 안될시)

```
set DOCKER_TLS_VERIFY=
set DOCKER_HOST=
set DOCKER_CERT_PATH=
set DOCKER_MACHINE_NAME=
```

- 도커 컨테이너 접속

C:\Users\admin\LSC>docker exec -it ros-ros2 /bin/bash
root@368d2b103abc:/#

- 아래 명령으로 로그인 시 ROS2 환경이 자동으로 설정되도록 합니다.

```
# echo "source /opt/ros/humble/setup.bash" >> ~/.bashrc
```

- ROS2 환경을 설정하기 위해 로그아웃 후 다시 로그인합니다.

```
# exit
$ docker exec -it ros-ros2 /bin/bash
```

- ROS2에서 Windows로 화면이 정상적으로 출력되는지 확인을 위해 아래 명령을 실행해서 turtlesim을 실행합니다. Windows에 아래와 같은 화면이 실행되면 정상입니다.

```
# ros2 run turtlesim turtlesim_node
```



![img](https://blog.kakaocdn.net/dn/lOKrL/btsnkM0M2lJ/6Qc8L96h6gicKkNo6cZ0J0/img.png)



- 다른 ‘Windows Power Shell’을 실행하고 ROS2에 접속 후 아래 명령을 실행해서 key를 입력받을 수 있는 ‘turtle_teleop_key’ 프로그램을 실행합니다.

```
$ docker exec -it ros-ros2 /bin/bash
# ros2 run turtlesim turtle_teleop_key
```



![img](https://blog.kakaocdn.net/dn/GEcEx/btsnoEgsCkF/pr2wN8lhAHrwsYNTheUNmK/img.png)



- 키보드의 상하좌우 화살표를 움직이면 화면의 로봇이 움직이는 것을 확인할 수 있습니다. 확인이 끝나면 CTRL+C를 눌러서 프로그램 두 개를 모두 종료합니다.



![img](https://blog.kakaocdn.net/dn/cJfIr1/btsno7JuMJf/sfn9IVmn2hyDK9cHBghLI0/img.png)



## 3. 관련 프로그램 및 Gazebo 설치하기

- Gazebo는 로봇을 시뮬레이션할 수 있는 프로그램입니다. 실제로 로봇을 구축하고 테스트하기에는 너무 많은 노력이 필요하므로 시뮬레이션을 충분히 해본 후 실제 로봇을 구축하는 것이 더 효율적입니다.
- 비슷한 툴에는 [Unity Robotics Simulation](https://unity.com/solutions/automotive-transportation-manufacturing/robotics), [NVIDIA Isaac Sim](https://developer.nvidia.com/isaac-sim) 등이 있습니다.
- ROS2 컨테이너에서 아래 명령을 실행해서 관련 프로그램 정보를 갱신합니다.

```
# apt update
```



![img](https://blog.kakaocdn.net/dn/FrYq0/btsnnNd1YJf/Ic4xAdoJtwnRzpMdpBWDS0/img.png)



- 아래 명령을 실행해서 변경된 프로그램을 업데이트합니다.

```
# apt upgrade
```



![img](https://blog.kakaocdn.net/dn/wPEXU/btsnnd5igP8/w8QNy4zICa3lo5m1lx0ye0/img.png)



- ROS 컨테이너에 추가로 필요한 프로그램 ‘git’, ‘python3-pip’를 아래 명령으로 설치합니다.

```
# apt install -y git python3-pip
```



![img](https://blog.kakaocdn.net/dn/X8EvZ/btsnocSmPNd/w4YJWAY3jRtkbpWkn54GzK/img.png)



- Gazebo 관련 프로그램을 아래 명령을 실행해서 설치합니다.

```
# apt install -y python3-colcon-common-extensions \
ros-humble-joint-state-publisher-gui \
ros-humble-gazebo-plugins \
ros-humble-joint-state-publisher \
ros-humble-gazebo-ros
```



![img](https://blog.kakaocdn.net/dn/FK1kW/btsnoiLlujX/WEkp54MR7yv0ODr6lXdCq0/img.png)



- 아래 명령을 실행해서 Gazebo를 실행합니다.(gazebo --verbose 로그 확인)

```
# gazebo
```



![img](https://blog.kakaocdn.net/dn/C9MZF/btsnqdPW2Lh/VfVUyVXkvkbW03KPEzdqs0/img.png)



- 아래와 같은 화면이 실행되면 정상입니다.



![img](https://blog.kakaocdn.net/dn/qj06p/btsnnNE761Q/u0YvFP6y2gCCOJ5nvp8NQK/img.png)





Source : https://with-rl.tistory.com/entry/Windows%EC%97%90%EC%84%9C-Docker%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%B4-ROS2-Gazebo-%EC%84%A4%EC%B9%98%ED%95%98%EA%B8%B0